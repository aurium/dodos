!function(e){function t(e,t){var n=document.createElement(e);for(att in t)"parent"==att?t.parent.appendChild(n):"html"==att?n.innerHTML=t.html:n.setAttribute(att,t[att]);return n}function n(e,t,n){var o=new Date;o.setDate(o.getDate()+(n||365)),t=escape(t)+"; expires="+o.toUTCString(),document.cookie=e+"="+t}function o(e){for(var t,n=document.cookie.split(/;\s+/),o=0;t=n[o];o++)if(t=t.split("="),t[0]==e)return unescape(t[1]);return!1}function a(e,n,o,a,i){console.log("createThing",e,n,o,a,i);var r;M.push(r=t(e,{style:"left:"+(n-10)+"px; top:"+(o-10)+"px;"+"width:"+(a+20)+"px; height:"+(i+20)+"px",parent:P})),r.type=e,r.x=n,r.y=o,r.w=a,r.h=i,"exit"==e&&(r.innerHTML="<e></e><e></e>")}function i(){S&&(S.className="",S=null,C.style.left="-99px")}function r(e){J.play(),i(),e.stopPropagation(),C.style.left="-99px",S=this;for(var t,n=0;t=F[n];n++)t.className="",t.target=null;this.className="sel"}function l(e){for(var t,n=0,o=0,a=0,i=0;t=F[i];i++)t!=e&&E(V(e.x-t.x))+E(V(e.y-t.y))<E(300)&&(n++,o+=t.x,a+=t.y,t==S&&(n+=E(N,1.5),o+=t.x*E(N,1.5),a+=t.y*E(N,1.5)));return 0==n?{x:P.w*U(),y:P.h*U()}:{x:o/n,y:a/n}}function c(e,t){return W(E(t.x-e.x)+E(t.y-e.y))}function f(e){for(var t,n=0;t=F[n];n++)if(t!=e&&E(V(e.x-t.x))+E(V(e.y-t.y))<E(34))return t}function p(e){e==S&&i();for(var t,n=[],o=0;t=F[o];o++)t!=e&&n.push(t);F=n,e.onclick=function(){},setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e)},3e3)}function u(){A.innerHTML="Saved: "+R+" <small>("+O+"+)</small>"+" &nbsp; Killed: "+D+" <small>(of "+N+")</small>"+" &nbsp; Time left: "+(B.time-Y)+"sec"}function y(e){D++,p(e),0==F.length&&(clearInterval(L),T("<h1>This Dodos fail<br><big>â˜¹</big></h1><p>You left all your dodos to the death without honor.</p>"+x(),function(){init(!0)}))}function d(e){j.play(),R++,p(e),e.className="saved",0==F.length&&(clearInterval(L),R>=O?(m(),T("<h1>This Dodos was Saved!<br><big>ðŸ˜„</big></h1><p>They are happy now in Sto'Vo'Kor.</p>"+x(),function(){init(!0)})):T("<h1>This Dodos fail<br><big>â˜¹</big></h1><p>You left many of your dodos to the death without honor.</p>"+x(),function(){init(!0)}))}function x(){var e=o("lastFinishedLevel");if(e){var t="Best moments:";e=parseInt(e);for(var n=0;e>=n;n++){var a=JSON.parse(o("level"+n));t+="<li>Level "+(n+1)+": Saved:"+a.saved+" Killed:"+a.killed+" Time:"+a.time+"sec</li>"}return t}return""}function m(){H>=0&&(console.log("finish level",H),n("lastFinishedLevel",H),lastRec=o("level"+H),lastRec&&(lastRec=JSON.parse(lastRec)),(!lastRec||lastRec.saved<R||lastRec.saved==R&&lastRec.time>Y)&&n("level"+H,JSON.stringify({saved:R,killed:D,time:Y})))}function v(e){for(var t,n=0;t=M[n];n++)e.x>t.x&&e.x<t.x+t.w&&e.y>t.y&&e.y<t.y+t.h&&thingAct[t.type](t,e)}function g(e,t){t||(t=1);var n=E(e.x)+E(e.y);return 0==n?{x:1,y:0}:(h=W(n),{x:e.x*t/h,y:e.y*t/h})}function w(e){var t,n,o,a,i,r,s;if(v(e),i=f(e))e.inertia=t=g({x:e.x-i.x,y:e.y-i.y},2);else if(e.target)t=g({x:e.target.x-e.x,y:e.target.y-e.y},3);else{t=l(e),(o=c(e,t))<150&&(n={x:P.w*U(),y:P.h*U()},o/=150,t={x:t.x*o+n.x*(1-o),y:t.y*o+n.y*(1-o)});var h=1;S&&c(e,S)>100&&(h=3),t=g({x:t.x-e.x,y:t.y-e.y},h)}e.x<20&&(t.x+=1),e.x>P.w-20&&(t.x-=1),e.y<20&&(t.y+=1),e.y>P.h-20&&(t.y-=1),e.inertia.x=t.x=(14*e.inertia.x+t.x)/15,e.inertia.y=t.y=(14*e.inertia.y+t.y)/15,e.x+=t.x,e.y+=t.y,r=g(t),s=Math.asin(r.y)*(180/Math.PI),r.x<0&&(s=180-s),e.angle=(2*e.angle+s)/3,a=e.style,a.left=e.x+"px",a.top=e.y+"px",a.transform=a.MozTransform=a.WebkitTransform="rotate("+e.angle+"deg)"}function b(){if(document.location.search){var e=document.location.search.substr(1).split("&");H=-1,B={name:"Unnamed",desc:"",time:60,conf:""};for(var t,a=0;t=e[a];a++)t=t.split("="),"level"==t[0]&&(t[0]="conf"),B[t[0]]=unescape(t[1]);console.log("User def level:",B),I(0,B)}else{var i=o("lastFinishedLevel");i=i?parseInt(i):-1,H=i+1,B=G[H],B?I(H+1,B):T("<h1>Congratulations!<br>You finish the journey</h1><p>Now the dodos are free from earth's violence and they will live a peaceful existence in Sto'Vo'Kor. Your name will be remembered by this successes and some day <u>they will come back</u> to take you to their paradise.</p>",function(){n("lastFinishedLevel",-1),init()},"Restart the Game")}}function T(e,n,o){o||(o="Ok!");var a=t("div",{class:"info",html:e,parent:P}),i=t("p",{class:"bts",parent:a}),r=t("button",{html:o,parent:i});r.onclick=function(){a.parentNode.removeChild(a),n()},r.focus()}function I(e,n){var o,i,l,h=n.conf.split("|");S=null,Y=0;var c=h.shift().split(",");for(N=parseInt(c[0]),O=parseInt(c[1]),c={x:parseInt(c[2]),y:parseInt(c[3])},u(),console.log("Start:",N,c),M=[],i=0;o=h[i];i++){for(o=o.split(","),l=1;5>l;l++)o[l]=parseInt(o[l]);h[i]=o}for(i=0;o=h[i];i++)"water"==o[0]&&a.apply(this,o);for(var i=0;200>i;i++)s=10+8*Math.random(),t("l",{style:"width:"+s+"px; height:"+s+"px; opacity:"+(.1+U()/5)+";"+"left:"+Math.round(U()*P.w)+"px; top:"+Math.round(U()*P.h)+"px;",parent:P});for(i=0;o=h[i];i++)"hole"==o[0]&&a.apply(this,o);for(i=0;o=h[i];i++)"exit"==o[0]&&(o[4]=o[3],a.apply(this,o));for(var i=0;N>i;i++)setTimeout(function(){var e;F.push(e=t("d",{html:"<h><v></v><i></i><i></i></h>",style:"left:-99px",parent:P})),e.onclick=r,e.x=c.x,e.y=c.y,e.inertia={x:2,y:U()-.5},e.angle=0},900*i);var f="";f=!e||1>e?"User Level":"Level "+e,n.name&&(f+="<br>"+n.name),T("<h1>"+f+"</h1>"+"<p>"+n.desc+"</p>"+"<p>There are "+N+" dodos and you must save at least "+O+" in "+n.time+" seconds.</p>",function(){K=new Date,L=setInterval(k,50)})}function k(){var e=new Date;if(e-q>100){water=document.getElementsByTagName("water");for(var t,n=0;t=water[n];n++)t.className="noAnim"}q=e,Y=Math.round((e-K)/1e3),0==B.time-Y&&(clearInterval(L),R>=O?(m(),T("<h1>This Dodos was Saved!<br><big>ðŸ˜„</big></h1><p>They are happy now in Sto'Vo'Kor.</p>"+x(),function(){init(!0)})):T("<h1>Time over<br><big>â˜¹</big></h1><p>You must be faster to save this dodos.</p>"+x(),function(){init(!0)}));for(var o,n=0;o=F[n];n++)w(o);u()}var N,S,M,L,C,D,R,O,A,B,H,K,Y,F=[],U=Math.random,V=Math.abs,W=Math.sqrt,E=function(e,t){return Math.pow(e,t||2)},J=new Audio("dodo.ogg"),j=new Audio("coin.ogg"),z=function(e){return document.getElementById(e)},P=z("area");P.w=800,P.h=500,P.onclick=function(e){S&&(J.play(),S.target={x:e.pageX-P.offsetLeft,y:e.pageY-P.offsetTop},C.style.left=S.target.x+"px",C.style.top=S.target.y+"px")},(window.onresize=function(){var e=(window.innerHeight-P.h)/2;e>0&&(P.style.top=e+"px")})(),thingAct={water:function(e,t){y(t),t.className="drowned"},hole:function(e,t){y(t),t.className="fallen"},exit:function(e,t){var n={x:e.x+e.w/2,y:e.y+e.h/2};t.target=n,c(t,n)<8&&d(t)}},e.init=function(e){for(L&&clearInterval(L),D=R=0;P.firstChild;)P.removeChild(P.firstChild);if(C=t("m",{parent:P,html:"<x></x><x></x>"}),A=t("div",{class:"scoreboard",html:"Starting...",parent:P}),e)introBtOk();else{var n=z("intro");P.appendChild(n),n.style.display="block",z("introBt").focus()}},e.introBtOk=function(){var e=z("intro");e.style.display="none",document.body.appendChild(e),b()};var q,G=[{name:"Starting the journey",time:120,desc:"Oh! Will be so easy to come to Sto'Vo'Kor!",conf:"20,10,-50,300|water,200,-10,300,100|hole,600,350,90,90|exit,650,100,120"},{name:"Holy F*** Water",time:90,desc:"I wish I could swim in my next life.",conf:"15,7,-50,450|water,-10,-10,330,330|water,230,450,150,200|water,450,300,400,250|water,420,-10,400,150|exit,680,170,100"},{name:"Holes",desc:"Watch your step...",time:60,conf:"20,7,-50,250|hole,60,30,60,60|hole,160,-100,250,300|hole,500,170,120,120|hole,650,15,40,40|hole,720,30,50,50|hole,70,400,60,60|hole,180,350,100,300|hole,310,300,170,150|hole,350,480,200,60|hole,510,320,80,80|hole,630,370,60,60|hole,600,470,120,60|hole,750,400,150,150|exit,660,250,100"}]}(this);